# P20 â€” Preference-Aware Router (Mocking Version)

- ID: P20-mocking
- Folder: `projects/p20-preference-aware-router-mocking`
- Status: draft
- Module: `m03_sessions_memory`

This is the **mocking version** of the Preference-Aware Router. It demonstrates the chain:

> **P18 â€” Preference Extraction** â†’ **P19 â€” Preference-Aware Persona** â†’ **P20 â€” Routing (Mock)**

No real ADK LlmAgent calls are made here. Instead, we load the Persona from P19 and route to one of two simulated agents.

---

## Concept: Persona â†’ Policy â†’ Mock Agent

The router answers: â€œGiven this Persona, what agent behavior should we choose?â€

Inputs inspected:
- `answer_style`
- `format_preferences`
- `dislikes`

Policy derived (examples):
- `prefer_structured_output`
- `prefer_code_examples`
- `avoid_marketing_style`
- `default_agent = structured_agent | narrative_agent`

Mock agents:
- `structured_agent_respond()` â€” structured, bullet-point output.
- `narrative_agent_respond()` â€” narrative, exploratory output.

---

## Project Structure

```text
projects/p20-preference-aware-router-mocking/
â”œâ”€â”€ README.md
â”œâ”€â”€ project.card.yaml
â”œâ”€â”€ persona_state.json        # Input generated by P19
â””â”€â”€ src/
    â””â”€â”€ main.py               # Full pipeline: load persona â†’ derive policy â†’ pick agent â†’ respond
```

---

## How to Run

From repository root `adk-decade-of-agents/`:
1) Activate venv: `source .venv/bin/activate` (prompt should show `(.venv)`).
2) Execute: `cd projects/p20-preference-aware-router-mocking/src && python main.py`.
   - Alternatively, run from project root and adjust the path: `python src/main.py`.

---

## Expected Output (sample)

```
ğŸš€ P20 â€” Preference-Aware Router v1 started
ğŸ“¥ Loading persona from: /Users/Agent/adk-decade-of-agents/projects/p20-preference-aware-router-mocking/persona_state.json
âœ… Persona loaded successfully.

ğŸ­ Persona Signals
------------------
- answer_style: concise, highly structured answers with clear reasoning and examples
- format_preferences: ['bullet_points', 'code_examples', 'clear_reasoning']
- dislikes: ['noisy_ux', 'over_marketing', 'vague_explanations']

ğŸ§­ Routing Decision
-------------------
- prefer_structured_output: True
- avoid_marketing_style: True
- prefer_code_examples: True
- default_agent: structured_agent
â†’ selected agent: structured_agent

ğŸ¤– Agent Response
-----------------
Structured Agent Response
- Style: concise, highly structured answers with clear reasoning and examples
- Known interests: reading_sci_fi, building_agent_projects, math_logic_games_with_children

Answer to: Explain what this ADK project does for the next decade of agents.
1) First, summarize the core idea.
2) Then, break it into clear, ordered steps.
3) Finally, suggest one concrete next action.

ğŸ P20 â€” Preference-Aware Router v1 finished
```

Persona fields vary with `persona_state.json`, but the printed sections (persona signals, policy, selected agent, response shape) should remain consistent.

---

## Files Touched

- Input: `persona_state.json` (read only)
- Output: console logs only (optionally add `routing_log.json` in future)

---

## Development Loop

1) Activate venv: `source .venv/bin/activate`
2) Enter project: `cd projects/p20-preference-aware-router-mocking`
3) Run: `cd src && python main.py`
4) Verify: no crashes; persona loads; policy is reasonable; selected mock agent matches expectations
5) Commit from repo root:
   - `git add .`
   - `git commit -m "P20-mocking: add preference-aware routing demo with mock agents"`

---

## Relationship to P20 â€œReal Agentâ€ Version

This mocking version is self-contained. A future real version can:
- Reuse the routing logic
- Replace mock agents with ADK `LlmAgent` calls
- Inject Persona into system prompts or session state
- Persist routing decisions (e.g., `routing_log.json`)

The goal here is to validate **Persona â†’ Policy â†’ Routing** before integrating real agents and tools.
